import{a as S,r as I}from"./request-DnmJyqEg.js";import{d as F,r as i,k as q,_,o as f,c as g,b as a,n as k,q as b,v as L,s as M,F as $,l as P,t as T,h as N,p as z,g as j,x as V,E as B,a as E,e as R,m as H}from"./index-CD2HnMUk.js";const O=F({props:{isActive:Boolean},setup(e,{emit:t}){const u=i({coverPhotoUrl:null,title:null,tag:null,categories:null,summary:null}),l=i(""),o=i(null),m=i([]),s=i([]),c=i([]),r=n=>{const p=n.target.files[0];p&&C(p)},C=async n=>{const p=new FormData;p.append("file",n),await S.post("http://localhost:9090/api/article/uploadImage",p,{headers:{"Content-Type":"multipart/form-data"}}).then(y=>{l.value=y.data.data,u.value.coverPhotoUrl=l.value})},h=n=>{t("isActive",n)},A=i(),U=()=>{var n;return u.value.summary=((n=o.value)==null?void 0:n.innerHTML)||null,t("confirmResult",u.value),h(!1),u.value},d=async()=>{const n=await I.get("/api/category/get");s.value=n.data;const p=await I.get("/api/tags/get");m.value=p.data},v=()=>{u.value={coverPhotoUrl:null,title:null,tag:null,categories:null,summary:null}};return q(()=>{d()}),{item:c,metaData:u,imageUrl:l,cacheData:A,categoryTableData:s,tagTableData:m,handleFileChange:r,clearMetaData:v,updateIsActive:h,confirm:U,editor:o}}}),D=e=>(z("data-v-00b42650"),e=e(),j(),e),G={key:0,class:"feature-popup"},J={class:"main"},K={class:"title"},Q=D(()=>a("p",null,"标题",-1)),W={class:"selectCategory"},X=D(()=>a("p",null,"分类",-1)),Y={class:"selectTag"},Z=D(()=>a("p",null,"标签",-1)),x={class:"summary"},ee=D(()=>a("p",null,"简介",-1)),te={class:"editor",contenteditable:"true",ref:"editor"};function ae(e,t,u,l,o,m){return e.isActive?(f(),g("div",G,[a("div",J,[a("div",{class:"coverImage",style:k({"background-image":"url("+e.imageUrl+")"})},[a("input",{style:{height:"100%",width:"100%",opacity:"0"},type:"file",ref:"fileInput",onChange:t[0]||(t[0]=(...s)=>e.handleFileChange&&e.handleFileChange(...s))},null,544)],4),a("div",K,[Q,b(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>e.metaData.title=s)},null,512),[[L,e.metaData.title]])]),a("div",W,[X,b(a("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>e.metaData.categories=s),class:"optionCategory"},[(f(!0),g($,null,P(e.categoryTableData,(s,c)=>(f(),g("option",{key:c},T(s.content),1))),128))],512),[[M,e.metaData.categories]])]),a("div",Y,[Z,b(a("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.metaData.tag=s),class:"optionTag"},[(f(!0),g($,null,P(e.tagTableData,(s,c)=>(f(),g("option",{key:c},T(s.content),1))),128))],512),[[M,e.metaData.tag]])]),a("div",x,[ee,a("div",te,null,512)]),a("div",{class:"cancel",onClick:t[4]||(t[4]=s=>e.updateIsActive(!1))}),a("div",{class:"confirm",onClick:t[5]||(t[5]=(...s)=>e.confirm&&e.confirm(...s))})])])):N("",!0)}const se=_(O,[["render",ae],["__scopeId","data-v-00b42650"]]),le=F({components:{featurePopup:se},setup(){const e=i(""),t=i(!1),u=i(!1),l=i(null),o=i(0),m=i(null),s=()=>{t.value=!t.value},c=()=>{m.value&&m.value.clearMetaData()},r=()=>{var v,n,p,y,w;const d={blogPost:{userId:"123",createdBy:"admin",createdTime:"2024-06-08T12:00:00",title:(v=l.value)==null?void 0:v.title,content:e.value,updatedTime:"2024-06-08T12:30:00",likesCount:0,readCount:0,commentCount:0,coverPhotoUrl:(n=l.value)==null?void 0:n.coverPhotoUrl,tag:(p=l.value)==null?void 0:p.tag,categories:(y=l.value)==null?void 0:y.categories,summary:(w=l.value)==null?void 0:w.summary,status:"已审核",isPinned:null,isLikeDisabled:null,isCommentsDisabled:null},isDraft:!0};o.value==2?I.post("api/article/upload",d).then(ce=>{e.value="",c()}):o.value==1?B({message:"请完善文章信息",type:"warning",plain:!0}):B({message:"请填写文章信息",type:"error",plain:!0})},C=()=>{if(l.value){const d=Object.values(l.value).filter(v=>v===null);d.length>1&&d.length<4?o.value=1:d.length==0?o.value=2:d.length==4&&(o.value=0)}},h=V(()=>{switch(o.value){case 0:return"#ee6a58";case 1:return"#ffbd44";case 2:return"#00ca4e";default:return"#ff605c"}}),A=V(()=>{switch(o.value){case 0:return"请完善文章信息";case 1:return"未填写完整信息";case 2:return"信息已填写完成";default:return"请完善文章信息"}});return{text:e,isActive:t,metaData:l,state:o,Color:h,isFormCompleted:A,isClearMeta:u,articleEditorRef:m,updateActive:s,handleConfirmResult:d=>{l.value=d,C()},isConfirmResult:C,uploadArticle:r,clearMetaDataInChild:c}}}),oe={class:"mask"},ne={class:"confirm"},ie={class:"title"},re={class:"editor"};function ue(e,t,u,l,o,m){const s=E("v-md-editor"),c=E("featurePopup");return f(),g($,null,[a("div",{class:H(["main",e.isActive?"active":""])},[a("div",oe,[a("div",ne,[a("div",{class:"icon",onClick:t[0]||(t[0]=(...r)=>e.uploadArticle&&e.uploadArticle(...r))},[a("i",{class:"iconfont",style:k({color:e.Color})},"",4)])]),a("div",{class:"blog-content-editor",onClick:t[1]||(t[1]=(...r)=>e.updateActive&&e.updateActive(...r))},[a("div",{class:"determine",style:k({backgroundColor:e.Color})},null,4),a("div",ie,T(e.isFormCompleted),1)]),a("div",re,[R(s,{modelValue:e.text,"onUpdate:modelValue":t[2]||(t[2]=r=>e.text=r),height:"100%"},null,8,["modelValue"])])])],2),R(c,{isActive:e.isActive,onUpdateIsActive:e.updateActive,onIsActive:t[3]||(t[3]=r=>e.isActive=r),onConfirmResult:e.handleConfirmResult,ref:"articleEditorRef"},null,8,["isActive","onUpdateIsActive","onConfirmResult"])],64)}const me=_(le,[["render",ue],["__scopeId","data-v-a68717f9"]]);export{me as default};
