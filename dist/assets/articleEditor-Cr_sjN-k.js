import{a as _,r as b}from"./request-DgN2nWOZ.js";import{d as R,r as i,k as S,_ as F,o as f,c as g,b as a,n as k,q as I,v as q,s as w,F as $,l as M,t as T,h as L,p as N,g as z,x as P,E as V,a as B,e as E,m as j}from"./index-CrLo8s4r.js";const H=R({props:{isActive:Boolean},setup(e,{emit:t}){const u=i({coverPhotoUrl:null,title:null,tag:null,categories:null,summary:null}),l=i(""),o=i(null),m=i([]),s=i([]),c=i([]),r=n=>{const p=n.target.files[0];p&&C(p)},C=async n=>{const p=new FormData;p.append("file",n),await _.post("http://localhost:9090/api/article/uploadImage",p,{headers:{"Content-Type":"multipart/form-data"}}).then(y=>{l.value=y.data.data,u.value.coverPhotoUrl=l.value})},h=n=>{t("isActive",n)},A=i(),U=()=>{var n;return u.value.summary=((n=o.value)==null?void 0:n.innerHTML)||null,t("confirmResult",u.value),h(!1),u.value},d=async()=>{const n=await b.get("/api/category/get");s.value=n.data;const p=await b.get("/api/tags/get");m.value=p.data},v=()=>{u.value={coverPhotoUrl:null,title:null,tag:null,categories:null,summary:null}};return S(()=>{d()}),{item:c,metaData:u,imageUrl:l,cacheData:A,categoryTableData:s,tagTableData:m,handleFileChange:r,clearMetaData:v,updateIsActive:h,confirm:U,editor:o}}}),D=e=>(N("data-v-cef13ae0"),e=e(),z(),e),O={key:0,class:"feature-popup"},G={class:"main"},J={class:"title"},K=D(()=>a("p",null,"标题",-1)),Q={class:"selectCategory"},W=D(()=>a("p",null,"分类",-1)),X={class:"selectTag"},Y=D(()=>a("p",null,"标签",-1)),Z={class:"summary"},x=D(()=>a("p",null,"简介",-1)),ee={class:"editor",contenteditable:"true",ref:"editor"};function te(e,t,u,l,o,m){return e.isActive?(f(),g("div",O,[a("div",G,[a("div",{class:"coverImage",style:k({"background-image":"url("+e.imageUrl+")"})},[a("input",{style:{height:"100%",width:"100%",opacity:"0"},type:"file",ref:"fileInput",onChange:t[0]||(t[0]=(...s)=>e.handleFileChange&&e.handleFileChange(...s))},null,544)],4),a("div",J,[K,I(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=s=>e.metaData.title=s)},null,512),[[q,e.metaData.title]])]),a("div",Q,[W,I(a("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>e.metaData.categories=s),class:"optionCategory"},[(f(!0),g($,null,M(e.categoryTableData,(s,c)=>(f(),g("option",{key:c},T(s.content),1))),128))],512),[[w,e.metaData.categories]])]),a("div",X,[Y,I(a("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>e.metaData.tag=s),class:"optionTag"},[(f(!0),g($,null,M(e.tagTableData,(s,c)=>(f(),g("option",{key:c},T(s.content),1))),128))],512),[[w,e.metaData.tag]])]),a("div",Z,[x,a("div",ee,null,512)]),a("div",{class:"cancel",onClick:t[4]||(t[4]=s=>e.updateIsActive(!1))}),a("div",{class:"confirm",onClick:t[5]||(t[5]=(...s)=>e.confirm&&e.confirm(...s))})])])):L("",!0)}const ae=F(H,[["render",te],["__scopeId","data-v-cef13ae0"]]),se=R({components:{featurePopup:ae},setup(){const e=i(""),t=i(!1),u=i(!1),l=i(null),o=i(0),m=i(null),s=()=>{t.value=!t.value},c=()=>{m.value&&m.value.clearMetaData()},r=()=>{var v,n,p,y;const d={blogPost:{userId:"123",createdBy:"admin",createdTime:"2024-06-08T12:00:00",title:(v=l.value)==null?void 0:v.title,content:e.value,updatedTime:"2024-06-08T12:30:00",likesCount:0,readCount:0,commentCount:0,coverPhotoUrl:l.value.coverPhotoUrl,tag:(n=l.value)==null?void 0:n.tag,categories:(p=l.value)==null?void 0:p.categories,summary:(y=l.value)==null?void 0:y.summary,status:"已审核",isPinned:null,isLikeDisabled:null,isCommentsDisabled:null},isDraft:!0};o.value==2?b.post("api/article/upload",d).then(ue=>{e.value="",c()}):o.value==1?V({message:"请完善文章信息",type:"warning",plain:!0}):V({message:"请填写文章信息",type:"error",plain:!0})},C=()=>{if(l.value){const d=Object.values(l.value).filter(v=>v===null);d.length>1&&d.length<4?o.value=1:d.length==0?o.value=2:d.length==4&&(o.value=0)}},h=P(()=>{switch(o.value){case 0:return"#ee6a58";case 1:return"#ffbd44";case 2:return"#00ca4e";default:return"#ff605c"}}),A=P(()=>{switch(o.value){case 0:return"请完善文章信息";case 1:return"未填写完整信息";case 2:return"信息已填写完成";default:return"请完善文章信息"}});return{text:e,isActive:t,metaData:l,state:o,Color:h,isFormCompleted:A,isClearMeta:u,articleEditorRef:m,updateActive:s,handleConfirmResult:d=>{l.value=d,C()},isConfirmResult:C,uploadArticle:r,clearMetaDataInChild:c}}}),le={class:"mask"},oe={class:"confirm"},ne={class:"title"},ie={class:"editor"};function re(e,t,u,l,o,m){const s=B("v-md-editor"),c=B("featurePopup");return f(),g($,null,[a("div",{class:j(["main",e.isActive?"active":""])},[a("div",le,[a("div",oe,[a("div",{class:"icon",onClick:t[0]||(t[0]=(...r)=>e.uploadArticle&&e.uploadArticle(...r))},[a("i",{class:"iconfont",style:k({color:e.Color})},"",4)])]),a("div",{class:"blog-content-editor",onClick:t[1]||(t[1]=(...r)=>e.updateActive&&e.updateActive(...r))},[a("div",{class:"determine",style:k({backgroundColor:e.Color})},null,4),a("div",ne,T(e.isFormCompleted),1)]),a("div",ie,[E(s,{modelValue:e.text,"onUpdate:modelValue":t[2]||(t[2]=r=>e.text=r),height:"100%"},null,8,["modelValue"])])])],2),E(c,{isActive:e.isActive,onUpdateIsActive:e.updateActive,onIsActive:t[3]||(t[3]=r=>e.isActive=r),onConfirmResult:e.handleConfirmResult,ref:"articleEditorRef"},null,8,["isActive","onUpdateIsActive","onConfirmResult"])],64)}const pe=F(se,[["render",re],["__scopeId","data-v-752491be"]]);export{pe as default};
